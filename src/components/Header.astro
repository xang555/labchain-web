---
import Logo from './Logo.astro';

const navItems = [
  { label: 'Home', href: '/' },
  { label: 'Documentation', href: '/docs' },
  { label: 'Community', href: '/community' },
];

const networkItems = [
  { label: 'RPC Endpoints', href: '/rpc', desc: 'Public RPC URLs' },
  { label: 'Boot Nodes', href: '/boot-nodes', desc: 'Execution layer nodes' },
  { label: 'Beacon Nodes', href: '/beacon-nodes', desc: 'Consensus layer nodes' },
];

const currentPath = Astro.url.pathname;
---

<header class="header">
  <div class="container">
    <nav class="nav">
      <a href="/" class="logo-link">
        <Logo size={36} />
      </a>

      <!-- Desktop Navigation -->
      <div class="nav-content-desktop">
        <ul class="nav-links">
          {navItems.map((item) => (
            <li>
              <a
                href={item.href}
                class:list={['nav-link', { active: currentPath === item.href }]}
              >
                {item.label}
              </a>
            </li>
          ))}
          <li class="nav-dropdown">
            <button
              class:list={['nav-link dropdown-trigger', { active: networkItems.some(item => currentPath === item.href) }]}
              aria-expanded="false"
            >
              Network
              <svg class="dropdown-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </button>
            <div class="dropdown-menu">
              {networkItems.map((item) => (
                <a
                  href={item.href}
                  class:list={['dropdown-item', { active: currentPath === item.href }]}
                >
                  <span class="dropdown-item-label">{item.label}</span>
                  <span class="dropdown-item-desc">{item.desc}</span>
                </a>
              ))}
            </div>
          </li>
        </ul>

        <div class="nav-actions">
          <button class="theme-toggle" id="themeToggleDesktop" aria-label="Toggle theme" title="Toggle theme">
            <svg class="icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="5"></circle>
              <line x1="12" y1="1" x2="12" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="23"></line>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
              <line x1="1" y1="12" x2="3" y2="12"></line>
              <line x1="21" y1="12" x2="23" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
            <svg class="icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
          </button>

          <a href="https://explorer.labchain.la/" class="btn btn-primary" target="_blank" rel="noopener noreferrer">
            Explorer
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
              <polyline points="15 3 21 3 21 9"></polyline>
              <line x1="10" y1="14" x2="21" y2="3"></line>
            </svg>
          </a>
        </div>
      </div>

      <!-- Mobile Menu Button -->
      <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle menu" aria-expanded="false">
        <span class="hamburger"></span>
      </button>
    </nav>
  </div>
</header>

<!-- Mobile Slide-in Menu (Outside header for proper positioning) -->
<div class="mobile-overlay" id="mobileOverlay"></div>
<div class="mobile-menu" id="mobileMenu">
  <div class="mobile-menu-header">
    <span class="mobile-menu-title">Menu</span>
    <button class="mobile-close-btn" id="mobileCloseBtn" aria-label="Close menu">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <nav class="mobile-nav">
    <ul class="mobile-nav-links">
      {navItems.map((item) => (
        <li>
          <a
            href={item.href}
            class:list={['mobile-nav-link', { active: currentPath === item.href }]}
          >
            {item.label}
          </a>
        </li>
      ))}
    </ul>

    <div class="mobile-nav-section">
      <span class="mobile-nav-section-title">Network</span>
      <ul class="mobile-nav-links">
        {networkItems.map((item) => (
          <li>
            <a
              href={item.href}
              class:list={['mobile-nav-link', { active: currentPath === item.href }]}
            >
              <span class="mobile-nav-link-label">{item.label}</span>
              <span class="mobile-nav-link-desc">{item.desc}</span>
            </a>
          </li>
        ))}
      </ul>
    </div>
  </nav>

  <div class="mobile-menu-footer">
    <button class="theme-toggle-mobile" id="themeToggleMobile" aria-label="Toggle theme">
      <svg class="icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="5"></circle>
        <line x1="12" y1="1" x2="12" y2="3"></line>
        <line x1="12" y1="21" x2="12" y2="23"></line>
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
        <line x1="1" y1="12" x2="3" y2="12"></line>
        <line x1="21" y1="12" x2="23" y2="12"></line>
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
      </svg>
      <svg class="icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
      </svg>
      <span class="theme-label">Toggle Theme</span>
    </button>

    <a href="https://explorer.labchain.la/" class="btn btn-primary mobile-explorer-btn" target="_blank" rel="noopener noreferrer">
      Explorer
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
        <polyline points="15 3 21 3 21 9"></polyline>
        <line x1="10" y1="14" x2="21" y2="3"></line>
      </svg>
    </a>
  </div>
</div>

<style>
  .header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    background: var(--bg-primary);
    border-bottom: 1px solid var(--border-color);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }

  [data-theme="light"] .header {
    background: rgba(255, 255, 255, 0.85);
  }

  [data-theme="dark"] .header {
    background: rgba(15, 23, 42, 0.9);
  }

  .nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: var(--header-height);
    gap: 24px;
  }

  .logo-link {
    display: flex;
    transition: opacity var(--transition-fast);
  }

  .logo-link:hover {
    opacity: 0.8;
  }

  /* Desktop Navigation */
  .nav-content-desktop {
    display: flex;
    align-items: center;
    gap: 32px;
  }

  .nav-links {
    display: flex;
    align-items: center;
    gap: 8px;
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .nav-link {
    display: block;
    padding: 8px 16px;
    font-size: 15px;
    font-weight: 500;
    color: var(--text-secondary);
    border-radius: var(--radius-md);
    transition: all var(--transition-fast);
    text-decoration: none;
  }

  .nav-link:hover {
    color: var(--text-primary);
    background: var(--bg-tertiary);
  }

  .nav-link.active {
    color: var(--color-primary);
    background: rgba(20, 137, 213, 0.1);
  }

  /* Desktop Dropdown */
  .nav-dropdown {
    position: relative;
  }

  .dropdown-trigger {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    border: none;
    background: none;
  }

  .dropdown-icon {
    transition: transform var(--transition-fast);
  }

  .nav-dropdown:hover .dropdown-icon {
    transform: rotate(180deg);
  }

  .dropdown-menu {
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    margin-top: 8px;
    min-width: 220px;
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    opacity: 0;
    visibility: hidden;
    transition: all var(--transition-fast);
    z-index: 100;
    padding: 8px;
  }

  .nav-dropdown:hover .dropdown-menu {
    opacity: 1;
    visibility: visible;
  }

  .dropdown-item {
    display: flex;
    flex-direction: column;
    gap: 2px;
    padding: 12px 16px;
    border-radius: var(--radius-md);
    transition: all var(--transition-fast);
    text-decoration: none;
  }

  .dropdown-item:hover {
    background: var(--bg-tertiary);
  }

  .dropdown-item.active {
    background: rgba(20, 137, 213, 0.1);
  }

  .dropdown-item-label {
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
  }

  .dropdown-item.active .dropdown-item-label {
    color: var(--color-primary);
  }

  .dropdown-item-desc {
    font-size: 12px;
    color: var(--text-tertiary);
  }

  .nav-actions {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .theme-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: var(--radius-md);
    color: var(--text-secondary);
    transition: all var(--transition-fast);
    background: transparent;
    border: none;
    cursor: pointer;
  }

  .theme-toggle:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
  }

  .icon-sun {
    display: block;
  }

  .icon-moon {
    display: none;
  }

  [data-theme="dark"] .icon-sun {
    display: none;
  }

  [data-theme="dark"] .icon-moon {
    display: block;
  }

  /* Mobile Menu Button - use :global() for cross-page consistency */
  :global(.mobile-menu-btn) {
    display: none;
    width: 40px;
    height: 40px;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius-md);
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 0;
    transition: background var(--transition-fast);
    z-index: 1001;
  }

  :global(.mobile-menu-btn:hover) {
    background: var(--bg-tertiary);
  }

  :global(.hamburger) {
    position: relative;
    width: 20px;
    height: 2px;
    background: var(--text-primary);
    border-radius: 2px;
    transition: all var(--transition-fast);
  }

  :global(.hamburger::before),
  :global(.hamburger::after) {
    content: '';
    position: absolute;
    left: 0;
    width: 20px;
    height: 2px;
    background: var(--text-primary);
    border-radius: 2px;
    transition: all var(--transition-fast);
  }

  :global(.hamburger::before) {
    top: -6px;
  }

  :global(.hamburger::after) {
    bottom: -6px;
  }

  :global(.mobile-menu-btn[aria-expanded="true"] .hamburger) {
    background: transparent;
  }

  :global(.mobile-menu-btn[aria-expanded="true"] .hamburger::before) {
    top: 0;
    transform: rotate(45deg);
  }

  :global(.mobile-menu-btn[aria-expanded="true"] .hamburger::after) {
    bottom: 0;
    transform: rotate(-45deg);
  }

  /* Mobile Overlay */
  :global(.mobile-overlay) {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 9998;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  :global(.mobile-overlay.active) {
    display: block;
    opacity: 1;
  }

  /* Mobile Slide-in Menu */
  :global(.mobile-menu) {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    width: 300px;
    max-width: 85vw;
    background: var(--bg-primary);
    z-index: 9999;
    transform: translateX(100%);
    transition: transform 0.3s ease;
    display: flex;
    flex-direction: column;
    box-shadow: -4px 0 20px rgba(0, 0, 0, 0.2);
  }

  :global([data-theme="light"] .mobile-menu) {
    background: #ffffff;
  }

  :global([data-theme="dark"] .mobile-menu) {
    background: #0F172A;
  }

  :global(.mobile-menu.active) {
    transform: translateX(0);
  }

  :global(.mobile-menu-header) {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    border-bottom: 1px solid var(--border-color);
  }

  :global(.mobile-menu-title) {
    font-size: 18px;
    font-weight: 600;
    color: var(--text-primary);
  }

  :global(.mobile-close-btn) {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: var(--radius-md);
    background: transparent;
    border: none;
    cursor: pointer;
    color: var(--text-secondary);
    transition: all var(--transition-fast);
  }

  :global(.mobile-close-btn:hover) {
    background: var(--bg-tertiary);
    color: var(--text-primary);
  }

  :global(.mobile-nav) {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
  }

  :global(.mobile-nav-links) {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  :global(.mobile-nav-link) {
    display: block;
    padding: 14px 16px;
    font-size: 16px;
    font-weight: 500;
    color: var(--text-secondary);
    border-radius: var(--radius-md);
    transition: all var(--transition-fast);
    text-decoration: none;
    margin-bottom: 4px;
  }

  :global(.mobile-nav-link:hover) {
    color: var(--text-primary);
    background: var(--bg-tertiary);
  }

  :global(.mobile-nav-link.active) {
    color: var(--color-primary);
    background: rgba(20, 137, 213, 0.1);
  }

  :global(.mobile-nav-link-label) {
    display: block;
    font-weight: 500;
  }

  :global(.mobile-nav-link-desc) {
    display: block;
    font-size: 12px;
    color: var(--text-tertiary);
    margin-top: 2px;
  }

  :global(.mobile-nav-section) {
    margin-top: 24px;
    padding-top: 24px;
    border-top: 1px solid var(--border-color);
  }

  :global(.mobile-nav-section-title) {
    display: block;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--text-tertiary);
    padding: 0 16px;
    margin-bottom: 12px;
  }

  :global(.mobile-menu-footer) {
    padding: 20px;
    border-top: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  :global(.theme-toggle-mobile) {
    display: flex;
    align-items: center;
    gap: 12px;
    width: 100%;
    padding: 12px 16px;
    border-radius: var(--radius-md);
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    cursor: pointer;
    color: var(--text-secondary);
    transition: all var(--transition-fast);
  }

  :global(.theme-toggle-mobile:hover) {
    color: var(--text-primary);
  }

  :global(.theme-label) {
    font-size: 14px;
    font-weight: 500;
  }

  :global(.mobile-explorer-btn) {
    width: 100%;
    justify-content: center;
    padding: 14px 24px;
  }

  /* Hide mobile elements on desktop */
  @media (min-width: 769px) {
    .mobile-menu,
    .mobile-overlay {
      display: none !important;
    }
  }

  /* Mobile Styles */
  @media (max-width: 768px) {
    .nav-content-desktop {
      display: none;
    }

    :global(.mobile-menu-btn) {
      display: flex !important;
    }
  }
</style>

<script is:inline>
  // Theme functions
  function getTheme() {
    var stored = localStorage.getItem('theme');
    if (stored === 'light' || stored === 'dark') return stored;
    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  }

  function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
  }

  // Initialize theme immediately
  setTheme(getTheme());

  // Mobile menu functions
  function openMobileMenu() {
    var menu = document.getElementById('mobileMenu');
    var overlay = document.getElementById('mobileOverlay');
    var btn = document.getElementById('mobileMenuBtn');
    if (menu && overlay && btn) {
      menu.classList.add('active');
      overlay.classList.add('active');
      btn.setAttribute('aria-expanded', 'true');
      document.body.style.overflow = 'hidden';
    }
  }

  function closeMobileMenu() {
    var menu = document.getElementById('mobileMenu');
    var overlay = document.getElementById('mobileOverlay');
    var btn = document.getElementById('mobileMenuBtn');
    if (menu && overlay && btn) {
      menu.classList.remove('active');
      overlay.classList.remove('active');
      btn.setAttribute('aria-expanded', 'false');
      document.body.style.overflow = '';
    }
  }

  function toggleMobileMenu() {
    var menu = document.getElementById('mobileMenu');
    if (menu && menu.classList.contains('active')) {
      closeMobileMenu();
    } else {
      openMobileMenu();
    }
  }

  // Initialize
  function initHeader() {
    // Mobile menu button
    var mobileMenuBtn = document.getElementById('mobileMenuBtn');
    if (mobileMenuBtn && !mobileMenuBtn.dataset.init) {
      mobileMenuBtn.dataset.init = 'true';
      mobileMenuBtn.addEventListener('click', function(e) {
        e.preventDefault();
        toggleMobileMenu();
      });
    }

    // Close button
    var closeBtn = document.getElementById('mobileCloseBtn');
    if (closeBtn && !closeBtn.dataset.init) {
      closeBtn.dataset.init = 'true';
      closeBtn.addEventListener('click', function(e) {
        e.preventDefault();
        closeMobileMenu();
      });
    }

    // Overlay click to close
    var overlay = document.getElementById('mobileOverlay');
    if (overlay && !overlay.dataset.init) {
      overlay.dataset.init = 'true';
      overlay.addEventListener('click', closeMobileMenu);
    }

    // Close on link click
    var mobileLinks = document.querySelectorAll('.mobile-nav-link');
    mobileLinks.forEach(function(link) {
      if (!link.dataset.init) {
        link.dataset.init = 'true';
        link.addEventListener('click', closeMobileMenu);
      }
    });

    // Theme toggles
    var themeToggleDesktop = document.getElementById('themeToggleDesktop');
    if (themeToggleDesktop && !themeToggleDesktop.dataset.init) {
      themeToggleDesktop.dataset.init = 'true';
      themeToggleDesktop.addEventListener('click', function() {
        var current = document.documentElement.getAttribute('data-theme');
        setTheme(current === 'dark' ? 'light' : 'dark');
      });
    }

    var themeToggleMobile = document.getElementById('themeToggleMobile');
    if (themeToggleMobile && !themeToggleMobile.dataset.init) {
      themeToggleMobile.dataset.init = 'true';
      themeToggleMobile.addEventListener('click', function() {
        var current = document.documentElement.getAttribute('data-theme');
        setTheme(current === 'dark' ? 'light' : 'dark');
      });
    }

    // Escape key to close
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeMobileMenu();
      }
    });
  }

  // Run initialization
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initHeader);
  } else {
    initHeader();
  }

  // Astro page transitions
  document.addEventListener('astro:page-load', initHeader);
</script>
